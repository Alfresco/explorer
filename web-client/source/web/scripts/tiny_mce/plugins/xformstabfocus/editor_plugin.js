alfresco.xforms.constants.XFORMS_CSS_SELECT_QUERY="input:enabled,area:tabindex,button:tabindex,object:tabindex,select:tabindex,textarea:tabindex";alfresco.xforms.constants.XFORMS_FOCUSABLE_ELEMENTS=["INPUT","AREA","BUTTON","OBJECT","SELECT","TEXTAREA"];(function(){var c=tinymce.DOM,a=tinymce.dom.Event,d=tinymce.each,b=tinymce.explode;tinymce.create("tinymce.plugins.XFormsTabFocusPlugin",{init:function(f,g){function e(i,k){var j=(k.which)?(k.wich):(k.keyCode);if(9===j){return a.cancel(k)}}function h(i,o){function p(z){var x=-1;var v=alfresco.xforms.constants.XFORMS_CSS_SELECT_QUERY;if((null!=z.editorCondition)&&(z.editorCondition.length>0)){v+=",*["+z.editorCondition+"]"}var t=((null!=z.forwardClasses)&&(z.forwardClasses.length>0))?(b(z.forwardClasses," ")):(null);var y=((null!=z.backwardClasses)&&(z.backwardClasses.length>0))?(b(z.backwardClasses," ")):(null);function w(A){d(A,function(B){v+=',a[class~="'+B+'"]';return true})}if(t){w(t)}if(y){w(y)}var q=((null!=z.formScopeId)&&(z.formScopeId.length>0))?(c.select(v,document.getElementById(z.formScopeId))):(c.select(v));if(q){var u=c.select("*["+z.editorCondition+"]");d(q,function(B,A){if(u.toString()==B.toString()){x=A;return false}return true});function r(C,B){if(null==B){return false}for(var A=0;A<C.length;A++){if(!c.hasClass(B,C[A])){return false}}return true}for(var s=(x+z.direction);(z.direction>0)?(s<q.length):(s>=0);s+=z.direction){if(!q[s].hidden&&("none"!=q[s].style.display)&&(q[s].tabIndex>=0)){if((("A"==q[s].tagName)&&r((z.direction>0)?(t):(y),q[s]))||(-1!=alfresco.xforms.constants.XFORMS_FOCUSABLE_ELEMENTS.indexOf(q[s].tagName))){return q[s]}}}}return null}var m=(o.which)?(o.which):(o.keyCode);if(9===m){var n=(o.shiftKey)?(-1):(1);var j={direction:n,formScopeId:i.getParam("form_scope_id"),editorCondition:i.getParam("editor_condition"),forwardClasses:i.getParam("forward_element_classes"),backwardClasses:i.getParam("backward_element_classes")};var l=p(j);if(l){var k=i;if(i=tinymce.EditorManager.get(l.id||l.name)){i.focus()}else{window.setTimeout(function(){window.focus();var q=k.getParam("pre_focus_changed_handler");if((null!=q)&&("function"==typeof(q))){q.call(q,n)}l.focus()},10)}return a.cancel(o)}}return true}f.onKeyUp.add(e);if(tinymce.isGecko){f.onKeyPress.add(h);f.onKeyDown.add(e)}else{f.onKeyDown.add(h)}},getInfo:function(){var e={longname:"XFormsTabFocus",author:"Dmitry Velichkevich",infourl:"http://alfresco.com/",version:tinymce.majorVersion+"."+tinymce.minorVersion};return e}});tinymce.PluginManager.add("xformstabfocus",tinymce.plugins.XFormsTabFocusPlugin)})();